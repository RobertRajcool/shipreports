{% extends 'base.html.twig' %}

{% block body %}

    {% block javascripts %}
        {% javascripts
        '@AppBundle/Resources/public/js/AAA.js'
        '@AppBundle/Resources/public/js/rules.js'
        %}
        <script src="{{ asset_url }}"></script>
        {% endjavascripts %}
        <script type="text/javascript">
            $(document).ready(function(){
                var listIcon = $('.list_icon');
                var boxIcon = $('.box_icon');
                var gridView = $('.grid_view');
                var listView = $('.list_view');
                var createKpi = $('.create_kpi');
                var addButton = $('.add_btn');
                var createCancelButton = $('.cancel_btn');
                var createForm = $('.create-form');
                var showKpi = $('.show_kpi');
                var kpiList = $('.kpi_class');
                var editButton = $('.edit_kpi_button');
                var editKpi = $('.grid_edit_kpi');
                var editCancelButton = $('.edit_cancel_button');
                var editSaveButton = $('.edit_submit_button');
                var shipNameOptions = $('#shipId option');
                listView.hide();
                boxIcon.hide();
                showKpi.hide();
                editKpi.hide();
                listIcon.click(function($e){
                    $e.preventDefault();
                    gridView.hide();
                    listIcon.hide();
                    createKpi.hide();
                    showKpi.hide();
                    editKpi.hide();
                    listView.show();
                    boxIcon.show();
                });
                boxIcon.click(function($e){
                    $e.preventDefault();
                    listView.hide();
                    boxIcon.hide();
                    showKpi.hide();
                    editKpi.hide();
                    gridView.show();
                    listIcon.show();
                    createKpi.show();
                });
                addButton.click(function($e){
                    $e.preventDefault();
                    listView.hide();
                    boxIcon.hide();
                    showKpi.hide();
                    editKpi.hide();
                    gridView.show();
                    listIcon.show();
                    createKpi.show();
                    $('.check').attr('checked',false);
                    shipNameOptions.attr('selected', false);
                });
                createCancelButton.click(function($e){
                    $e.preventDefault();
                    editKpi.hide();
                    createForm[0].reset();
                });
                $('#check').live("click",function(){
                    if($('#check').is(':checked')==true)
                    {
                        shipNameOptions.attr('selected', 'selected');
                    }
                    else
                    {
                        shipNameOptions.attr('selected', false);
                    }
                });
                var ruleObjectText = $('#rule_obj_text');
                var ruleDiv = $('.show_rule_div');
                var editRuleTable = $('.rule_table_edit');
                var ruleEditPlace = $('.rule_edit_place');
                var shipName = $('.ship_name');
                var kpiName = $('.kpi_name');
                var kpiDescription = $('.kpi_description');
                var kpiWeight = $('.kpi_weightage');
                var kpiCellName = $('.kpi_cellName');
                var kpiCellDetail = $('.kpi_cellDetail');
                var showRuleTable = $('.rule_table');
                var activeMonth = $('.kpi_activeDate_month');
                var activeYear = $('.kpi_activeDate_year');
                var endMonth = $('.kpi_endDate_month');
                var endYear = $('.kpi_endDate_year');

                var condition_text = "";
                var count = 0;
                var i = 0;
                kpiList.live("click",function($e){
                    $e.preventDefault();
                    createKpi.hide();
                    editKpi.hide();
                    count++;
                    if(count>1){
                        showKpi.hide();
                        $('.ship_name_edit').empty();
                        editRuleTable.empty();
                        var emptyFunction = emptyTheDetailsFunction(data);
                    }
                    var currentId = $(this).attr('id');
                    var data = {Id : currentId};
                    $.ajax({
                        type: "POST",
                        data: data,
                        url: "ranking_kpi_ajax_show",
                        success: function(data){
                            ruleDiv.hide();
                            var result = successFunction(data);
                        },
                        error: function(XMLHttpRequest, textStatus, errorThrown) {
                            alert('Error : ' + errorThrown);
                        }
                    });
                });

                function emptyTheDetailsFunction(data){
                    shipName.empty();
                    kpiName.empty();
                    kpiDescription.empty();
                    kpiWeight.empty();
                    kpiCellName.empty();
                    kpiCellDetail.empty();
                    showRuleTable.empty();
                    ruleObjectText.empty();
                    activeMonth.empty();
                    activeYear.empty();
                    endMonth.empty();
                    endYear.empty();
                }

                function successFunction(data){
                    var monthNames = ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"];
                    var active_date = new Date(data.kpi_detail[0].activeDate.date);
                    var end_date = new Date(data.kpi_detail[0].endDate.date);
                    kpiName.append(data.kpi_detail[0].kpiName);
                    kpiDescription.append(data.kpi_detail[0].description);
                    kpiWeight.append(data.kpi_detail[0].weightage);
                    kpiCellName.append(data.kpi_detail[0].cellName);
                    kpiCellDetail.append(data.kpi_detail[0].cellDetails);
                    activeMonth.append(monthNames[active_date.getMonth()]);
                    activeYear.append(active_date.getFullYear());
                    endMonth.append(monthNames[end_date.getMonth()]);
                    endYear.append(end_date.getFullYear());

                    $('.edit_kpi_name').val(data.kpi_detail[0].kpiName);
                    $('.edit_kpi_description').val(data.kpi_detail[0].description);
                    $('.edit_kpi_weightage').val(data.kpi_detail[0].weightage);
                    $('.edit_kpi_cellName').val(data.kpi_detail[0].cellName);
                    $('.edit_kpi_cellDetails').val(data.kpi_detail[0].cellDetails);
                    $('.kpi_edit_id').val(data.kpi_detail[0].id);
                    $('.active_month').val(active_date.getMonth());
                    $('.active_year').val(active_date.getFullYear());
                    $('.end_month').val(end_date.getMonth());
                    $('.end_year').val(end_date.getFullYear());

                    var shipIdArray = [];
                    $.each(data.ship_name, function(shipCount){
                        shipIdArray.push(data.ship_name[shipCount][0]['id']);
                    });

                    $.each(data.ship_array,function(index)
                    {
                        if(shipIdArray.indexOf(data.ship_array[index]['id']) != -1){
                            var $option = $('<option>').append(data.ship_array[index]['shipName']).val(data.ship_array[index]['id']).attr('selected', true).appendTo('.ship_name_edit');
                        }else{
                            var $option = $('<option>').append(data.ship_array[index]['shipName']).val(data.ship_array[index]['id']).appendTo('.ship_name_edit');
                        }
                    });
                    $.each(data.ship_name, function(shipNameCount)
                    {
                        $('.ship_name').append(data.ship_name[shipNameCount][0]['shipName']).append(', ');
                    });
                    if(data.kpi_rules.length>0){
                        $.each(data.kpi_rules,function(k)
                        {
                            i++;
                            var rule_obj = JSON.parse(data.kpi_rules[k].rules);
                            var new_rule_obj = rule_obj.conditions.all;
                            ruleObjectText.append($('<input>').attr({'type':'hidden','name':'rule_name['+i+']', 'id':'rule_obj_text-'+i+''}).val(data.kpi_rules[k].rules));
                            ruleObjectText.append($('<br>'));
                            $.each(new_rule_obj, function(j)
                            {
                                new_rule_obj[j].operator =rule_operator(new_rule_obj[j].operator);
                                var condition_text_one = new_rule_obj[j].operator+new_rule_obj[j].value;
                                if(j==0)
                                {
                                    condition_text = condition_text_one;
                                }
                                if(j>0)
                                {
                                    condition_text = condition_text+'   ' + '&&' +'   '+condition_text_one;
                                }
                            });
                            var findColor = findColorFunction(rule_obj);
                        });
                        showKpi.show();
                        ruleDiv.show();
                    }
                    showKpi.show();
                }

                function findColorFunction(rule_obj){
                    if(rule_obj.actions.value=="Green"){
                        var $trGreen = $('<tr>').attr({'id':'row_id-'+i}).append(
                                $('<td>').text(condition_text),
                                $('<td style="color: green">').text(rule_obj.actions.value)
                        ).appendTo('.rule_table');
                        var $tr1Green = $('<tr>').attr({'id':'row_edit_id-'+i}).append(
                                $('<td class="conditions">').text(condition_text),
                                $('<td class="color" style="color: green">').text(rule_obj.actions.value),
                                $('<td>').append($('<a></a>').attr({'id':'edit-'+i+'','class':'edit_icon_btn ss-write edit_class'})),
                                $('<td>').append($('<a></a>').attr({'id':'delete-'+i+'','class':'delete_icon_btn ss-delete delete_class'}))
                        ).appendTo('.rule_table_edit');
                    }
                    if(rule_obj.actions.value=="Yellow"){
                        var $trYellow = $('<tr>').attr({'id':'row_id-'+i}).append(
                                $('<td>').text(condition_text),
                                $('<td style="color: orange">').text(rule_obj.actions.value)
                        ).appendTo('.rule_table');
                        var $tr1Yellow = $('<tr>').attr({'id':'row_edit_id-'+i}).append(
                                $('<td class="conditions">').text(condition_text),
                                $('<td class="color" style="color: orange">').text(rule_obj.actions.value),
                                $('<td>').append($('<a></a>').attr({'id':'edit-'+i+'','class':'edit_icon_btn ss-write edit_class'})),
                                $('<td>').append($('<a></a>').attr({'id':'delete-'+i+'','class':'delete_icon_btn ss-delete delete_class'}))
                        ).appendTo('.rule_table_edit');
                    }
                    if(rule_obj.actions.value=="Red"){
                        var $trRed = $('<tr>').attr({'id':'row_id-'+i}).append(
                                $('<td>').text(condition_text),
                                $('<td style="color: red">').text(rule_obj.actions.value)
                        ).appendTo('.rule_table');
                        var $tr1Red = $('<tr>').attr({'id':'row_edit_id-'+i}).append(
                                $('<td class="conditions">').text(condition_text),
                                $('<td class="color" style="color: red">').text(rule_obj.actions.value),
                                $('<td>').append($('<a></a>').attr({'id':'edit-'+i+'','class':'edit_icon_btn ss-write edit_class'})),
                                $('<td>').append($('<a></a>').attr({'id':'delete-'+i+'','class':'delete_icon_btn ss-delete edit_delete_class'}))
                        ).appendTo('.rule_table_edit');
                    }
                }

                function rule_operator(operator) {
                    if(operator=='equalTo') {
                        operator = '=';
                    }
                    else if(operator=='notEqualTo') {
                        operator = '!=';
                    }
                    else if(operator=='greaterThan') {
                        operator = '>';
                    }
                    else if(operator=='greaterThanEqual') {
                        operator = '>=';
                    }
                    else if(operator =='lessThan') {
                        operator = '<';
                    }
                    else if(operator=='lessThanEqual') {
                        operator = '<=';
                    }
                    return operator;
                }
                editButton.click(function($e){
                    $e.preventDefault();
                    showKpi.hide();
                    editKpi.show();
                    ruleEditPlace.hide();
                    $('.check').attr('checked',true);
                });
                editCancelButton.click(function($e){
                    $e.preventDefault();
                    editKpi.hide();
                    showKpi.show();
                });
                $('#editShipId').live("click",function(){
                    var editShipNameOptions = $('#editShipId option');
                    $('.check').attr('checked',false);
                    $('#edit-check').live("click",function(){
                        if($('#edit-check').is(':checked')==true)
                        {
                            editShipNameOptions.attr('selected', true);
                        }
                        else
                        {
                            editShipNameOptions.attr('selected', false);
                        }
                    });
                });
                editSaveButton.live("click",function($e){
                    $e.preventDefault();
                    var count_row = $('.rule_table_edit tr').length;
                    var rule_array = new Array();
                    for(var i_i=1;i_i<count_row;i_i++)
                    {
                        rule_array.push($('#rule_obj_text-'+i_i).val());
                    }
                    var data = {
                        kpiName : $('.edit_kpi_name').val(),
                        weightage : $('.edit_kpi_weightage').val(),
                        description : $('.edit_kpi_description').val(),
                        cellName : $('.edit_kpi_cellName').val(),
                        cellDetails : $('.edit_kpi_cellDetails').val(),
                        Id : $('.kpi_edit_id').val(),
                        activeMonth : $('.active_month').val(),
                        activeYear : $('.active_year').val(),
                        endMonth : $('.end_month').val(),
                        endYear : $('.end_year').val(),
                        rules : rule_array
                    };
                    var emptyFunction = emptyTheDetailsFunction(data);
                    $.ajax({
                        type: "POST",
                        data: data,
                        url: "ranking_ajax_edit",
                        success: function(data) {
                            editKpi.hide();
                            editRuleTable.empty();
                            var result = successFunction(data);

                        },
                        error: function(XMLHttpRequest, textStatus, errorThrown)
                        {
                            alert('Error : ' + errorThrown);
                        }
                    });
                });

                //Rules concept script
                var ruleCount = 0;
                var addAction = $('.add');
                var subCondition = $('.add-condition');
                var addRule = $('.add-rule');
                var dynamicAdd = $('.dynamic-add');
                var ruleShowTableRow = $('#row_id');
                var availableRow = $('#rule-table tr');
                var addRuleStatus = 0;
                var textBox = "";
                addAction.hide();
                ruleShowTableRow.hide();

                addRule.click(function($e){
                    $e.preventDefault();
                    if(addRuleStatus==0){
                        addRuleStatus=1;
                        ruleCount++;
                        addAction.show();
                        subCondition.show();
                        dynamicAdd = $("<a>",{"class":"dynamic-add", "id":"dynamicAdd_"+ruleCount, "text":"Add", "href":""});
                        $('.add_button_place').append(dynamicAdd);
                        textBox = $("<input>",{"type":"hidden","class":"rulesTextBox","id":"rules-id_"+ruleCount,"name":"rules-"+ruleCount});
                        $('.textbox-place').append(textBox);
                    }
                    else{
                        alert('Save the rule');
                        return false;
                    }
                });

                dynamicAdd.live("click",function($e){
                    $e.preventDefault();
                    addRuleStatus=0;
                    var currentId = $(this).attr('id');
                    var idNum = splitFun(currentId);
                    var rulesId = $('#rules-id_'+idNum);
                    var rule = rulesId.val();
                    var rule_obj = JSON.parse(rule);
                    var con = rule_obj.conditions.all;
                    var newRuleObject = con.filter(filterByID);
                    rule_obj.conditions.all = newRuleObject;
                    var final_rule = JSON.stringify(rule_obj);
                    rulesId.val(final_rule);
                    $(this).remove();
                    subCondition.hide();
                    $('.rule').remove();
                    $('.actionSelect').hide();
                    addAction.hide();

                    $.each(newRuleObject, function(j)
                    {
                        newRuleObject[j].operator =rule_operator(newRuleObject[j].operator);

                        var condition_text_one = newRuleObject[j].operator+newRuleObject[j].value;
                        if(j==0)
                        {
                            condition_text = condition_text_one;
                        }
                        if(j>0)
                        {
                            condition_text = condition_text+'   ' + '&&' +'   '+condition_text_one;
                        }
                    });
                    i++;
                    var colorValue = " ";
                    if(rule_obj.actions.value!=null){
                        colorValue = rule_obj.actions.value;
                    }
                    ruleShowTableRow.show();
                    var $tr = $('<tr>').attr({'id':'row-id_'+i}).append(
                            $('<td>').text(condition_text),
                            $('<td>').text(colorValue),
                            $('<td>').append($('<a>').attr({'id':'delete_'+i+'', 'class':'delete_class delete_icon_btn ss-delete'}))
                    ).appendTo('#rule-table');
                });

                var deleteRow = $('.delete_class');
                deleteRow.live("click",function($e){
                    $e.preventDefault();
                    var currentId = $(this).attr("id");
                    var idNum = splitFun(currentId);
                    $('#row-id_'+idNum).remove();
                    var countRow = availableRow.length;
                    if(countRow<=1)
                    {
                        ruleShowTableRow.hide();
                    }
                });

                function splitFun(data){
                    var num = data.split('_');
                    return num[1];
                }

                function filterByID(obj) {
                    if(jQuery.isEmptyObject(obj)) {
                        return false;
                    } else {
                        return true;
                    }
                }

                var editClassIcon = $('.edit_class');
                var status = 0;
                editClassIcon.live("click",function($e){
                    $e.preventDefault();
                    if(status==0){
                        status=1;
                        var conditions = $('#conditions-edit');
                        var actions = $('#actions-edit');
                        var currentId = $(this).attr("id");
                        var ageField = $("#ageField");
                        var submit = $('.edit_add_class');
                        var idNum = editSplitFun(currentId);
                        $('#row_edit_id-'+idNum).remove();
                        var ruleString = $('#rule_obj_text-'+idNum).val();
                        var object_rule = JSON.parse(ruleString);
                        $('#rule_edit_button').append($('<a href="">Save</a>').attr({'id':'edit_add-'+idNum+'', 'class':'edit_add_class'}));
                        ruleEditPlace.show();
                        addAction.show();
                        subCondition.show();

                        initializeConditions();
                        initializeActions();
                        initializeForm();

                        function initializeConditions() {
                            conditions.conditionsBuilder({
                                fields: [
                                    {label: "Value", name: "ageField", operators: [
                                        {label: "is present", name: "present", fieldType: "none"},
                                        {label: "is blank", name: "blank", fieldType: "none"},
                                        {label: "is equal to", name: "equalTo", fieldType: "text"},
                                        {label: "is not equal to", name: "notEqualTo", fieldType: "text"},
                                        {label: "is greater than", name: "greaterThan", fieldType: "text"},
                                        {label: "is greater than or equal to", name: "greaterThanEqual", fieldType: "text"},
                                        {label: "is less than", name: "lessThan", fieldType: "text"},
                                        {label: "is less than or equal to", name: "lessThanEqual", fieldType: "text"}
                                    ]}
                                ],
                                data: object_rule.conditions
                            });
                        }
                        function initializeActions() {
                            actions.actionsBuilder({
                                fields: [
                                    {label: "Green", name: "Green"},
                                    {label: "Red", name: "Red"},
                                    {label: "Yellow", name: "Yellow"}
                                ],
                                data: [object_rule.actions]
                            });
                        }
                        function initializeForm() {
                            var edit_condition_text="";
                            submit.live("click",function($e) {
                                $e.preventDefault();
                                if(status==1){
                                    status=0;
                                    var currentId = $(this).attr('id');
                                    var id_value = editSplitFun(currentId);
                                    var engine = new RuleEngine({
                                        conditions: conditions.conditionsBuilder("data"),
                                        actions: actions.actionsBuilder("data")
                                    });
                                    $(this).remove();
                                    ruleEditPlace.hide();
                                    conditions.remove();
                                    actions.empty();
                                    var sample = JSON.stringify(engine);
                                    $('#rule_obj_text-'+id_value).val(sample);
                                    var newRuleObject = engine.conditions.all;
                                    $.each(newRuleObject, function(conditionCount){
                                        newRuleObject[conditionCount].operator =rule_operator(newRuleObject[conditionCount].operator);
                                        var edit_condition_text_one =newRuleObject[conditionCount].operator+newRuleObject[conditionCount].value;

                                        if(conditionCount==0)
                                        {
                                            edit_condition_text = edit_condition_text_one;
                                        }
                                        if(conditionCount>0)
                                        {
                                            edit_condition_text = edit_condition_text+'   ' + '&&' +'   '+edit_condition_text_one;
                                        }
                                        var findColor = editColorFunction(engine.actions.value,id_value,edit_condition_text);
                                    });
                                }
                            });
                        }
                    }
                    else{
                        alert("Save the selected rule");
                    }

                });

                function editColorFunction(color,id_value,edit_condition_text){
                    if(color=="Green"){
                        var $trGreen = $('<tr>').attr({'id':'row_edit_id-'+id_value}).append(
                                $('<td>').text(edit_condition_text),
                                $('<td style="color: green">').text(color),
                                $('<td>').append($('<a>').attr({ 'id':'edit-'+id_value+'', 'class':'edit_icon_btn ss-write edit_class'})),
                                $('<td>').append($('<a>').attr({ 'id':'delete-'+id_value+'', 'class':'delete_icon_btn ss-delete delete_class'}))
                        ).appendTo('.rule_table_edit');
                    }
                    if(color=="Yellow"){
                        var $trYellow = $('<tr>').attr({'id':'row_edit_id-'+id_value}).append(
                                $('<td>').text(edit_condition_text),
                                $('<td style="color: orange">').text(color),
                                $('<td>').append($('<a>').attr({ 'id':'edit-'+id_value+'', 'class':'edit_icon_btn ss-write edit_class'})),
                                $('<td>').append($('<a>').attr({ 'id':'delete-'+id_value+'', 'class':'delete_icon_btn ss-delete delete_class'}))
                        ).appendTo('.rule_table_edit');
                    }
                    if(color=="Red"){
                        var $trRed = $('<tr>').attr({'id':'row_edit_id-'+id_value}).append(
                                $('<td>').text(edit_condition_text),
                                $('<td style="color: red">').text(color),
                                $('<td>').append($('<a>').attr({ 'id':'edit-'+id_value+'', 'class':'edit_icon_btn ss-write edit_class'})),
                                $('<td>').append($('<a>').attr({ 'id':'delete-'+id_value+'', 'class':'delete_icon_btn ss-delete delete_class'}))
                        ).appendTo('.rule_table_edit');
                    }
                }

                function editSplitFun(data){
                    var num = data.split('-');
                    return num[1];
                }

                $('.edit_delete_class').live("click",function($e){
                    $e.preventDefault();
                    var currentId = $(this).attr('id');
                    var id_value = splitfun(currentId);
                    $('#row_edit_id-'+id_value).remove();
                    var count_row = $('.rule_table_edit tr').length;
                    if(count_row<=1)
                    {
                        $('#row_edit_id').hide();
                    }
                });

            });
        </script>
    {% endblock %}

    <div class="grid_view">
        <section>
            <div class="col-sm-3 users_views">
                <div class="add_user_btn_main">
                    <span class="user_btn_main"><a href="" class="ss-plus add_btn">Add KPI</a></span>
                    <span class="user_btn_main grid_list_main">
                        <span class="active"><a href="" class="grid_list_icon ss-grid box_icon" >&nbsp;</a></span>
                        <span><a href="" class="grid_list_icon ss-rows list_icon" >&nbsp;</a></span>
                    </span>
                </div>
                <div class="users_list_main"><span>KPI ({{ kpi_count }})</span> <span class="show_dropdown_icon">&nbsp;</span></div>
                <div class="users_list_grid_main">
                    {% for kpiDetail in kpiDetails %}
                        <div class="users_list_grid">
                            <span class="users_name_row">
                                <span class="name"><a href="" class="kpi_class" id={{ kpiDetail.id }}>{{ kpiDetail.kpiName }}</a> </span>
                                <span class="text">
                                    {% if kpiDetail.activeDate|date('m') == 01 %}
                                        Jan-{{ kpiDetail.activeDate|date('Y') }}
                                    {% elseif kpiDetail.activeDate|date('m') == 02 %}
                                        Feb-{{ kpiDetail.activeDate|date('Y') }}
                                    {% elseif kpiDetail.activeDate|date('m') == 03 %}
                                        Mar-{{ kpiDetail.activeDate|date('Y') }}
                                    {% elseif kpiDetail.activeDate|date('m') == 04 %}
                                        Apr-{{ kpiDetail.activeDate|date('Y') }}
                                    {% elseif kpiDetail.activeDate|date('m') == 05 %}
                                        May-{{ kpiDetail.activeDate|date('Y') }}
                                    {% elseif kpiDetail.activeDate|date('m') == 06 %}
                                        Jun-{{ kpiDetail.activeDate|date('Y') }}
                                    {% elseif kpiDetail.activeDate|date('m') == 07 %}
                                        Jul-{{ kpiDetail.activeDate|date('Y') }}
                                    {% elseif kpiDetail.activeDate|date('m') == 08 %}
                                        Aug-{{ kpiDetail.activeDate|date('Y') }}
                                    {% elseif kpiDetail.activeDate|date('m') == 09 %}
                                        Sep-{{ kpiDetail.activeDate|date('Y') }}
                                    {% elseif kpiDetail.activeDate|date('m') == 10 %}
                                        Oct-{{ kpiDetail.activeDate|date('Y') }}
                                    {% elseif kpiDetail.activeDate|date('m') == 11 %}
                                        Nov-{{ kpiDetail.activeDate|date('Y') }}
                                    {% elseif kpiDetail.activeDate|date('m') == 12 %}
                                        Dec-{{ kpiDetail.activeDate|date('Y') }}
                                    {% endif %}
                                    To
                                    {% if kpiDetail.endDate|date('m') == 01 %}
                                        Jan-{{ kpiDetail.endDate|date('Y') }}
                                    {% elseif kpiDetail.endDate|date('m') == 02 %}
                                        Feb-{{ kpiDetail.endDate|date('Y') }}
                                    {% elseif kpiDetail.endDate|date('m') == 03 %}
                                        Mar-{{ kpiDetail.endDate|date('Y') }}
                                    {% elseif kpiDetail.endDate|date('m') == 04 %}
                                        Apr-{{ kpiDetail.endDate|date('Y') }}
                                    {% elseif kpiDetail.endDate|date('m') == 05 %}
                                        May-{{ kpiDetail.endDate|date('Y') }}
                                    {% elseif kpiDetail.endDate|date('m') == 06 %}
                                        Jun-{{ kpiDetail.endDate|date('Y') }}
                                    {% elseif kpiDetail.endDate|date('m') == 07 %}
                                        Jul-{{ kpiDetail.endDate|date('Y') }}
                                    {% elseif kpiDetail.endDate|date('m') == 08 %}
                                        Aug-{{ kpiDetail.endDate|date('Y') }}
                                    {% elseif kpiDetail.endDate|date('m') == 09 %}
                                        Sep-{{ kpiDetail.endDate|date('Y') }}
                                    {% elseif kpiDetail.endDate|date('m') == 10 %}
                                        Oct-{{ kpiDetail.endDate|date('Y') }}
                                    {% elseif kpiDetail.endDate|date('m') == 11 %}
                                        Nov-{{ kpiDetail.endDate|date('Y') }}
                                    {% elseif kpiDetail.endDate|date('m') == 12 %}
                                        Dec-{{ kpiDetail.endDate|date('Y') }}
                                    {% endif %}
                                </span>
                            </span>
                        </div>
                    {% endfor %}
                </div>
            </div>
        </section>
    </div>
    <div class="list_view">
        <section>
            <div class="users_advanced_list_views_screen">
                <div class="">
                    <div class="add_user_btn_main">
                        <span class="user_btn_main"><a href="" class="ss-plus add_btn"> Add KPI</a></span>
                        <span class="user_btn_main grid_list_main">
                            <span class="active"><a href="" class="grid_list_icon ss-grid box_icon" >&nbsp;</a></span>
                            <span><a href="" class="grid_list_icon ss-rows list_icon" >&nbsp;</a></span>
                         </span>
                    </div>
                    <div class="spacing"></div>
                    <div class="table-responsive">
                        <table class="table table-striped">
                            <thead>
                            <tr>
                                <th>KpiName</th>
                                <th>Description</th>
                                <th>StartDate</th>
                                <th>EndDate</th>
                                <th>CellName</th>
                                <th>CellDetails</th>
                            </tr>
                            </thead>
                            <tbody>
                            {% for kpiDetail in kpiDetails %}
                                <tr>
                                    <td>{{ kpiDetail.kpiName }}</td>
                                    <td>{{ kpiDetail.description }}</td>
                                    <td>
                                        {% if kpiDetail.activeDate|date('m') == 01 %}
                                            Jan-{{ kpiDetail.activeDate|date('Y') }}
                                        {% elseif kpiDetail.activeDate|date('m') == 02 %}
                                            Feb-{{ kpiDetail.activeDate|date('Y') }}
                                        {% elseif kpiDetail.activeDate|date('m') == 03 %}
                                            Mar-{{ kpiDetail.activeDate|date('Y') }}
                                        {% elseif kpiDetail.activeDate|date('m') == 04 %}
                                            Apr-{{ kpiDetail.activeDate|date('Y') }}
                                        {% elseif kpiDetail.activeDate|date('m') == 05 %}
                                            May-{{ kpiDetail.activeDate|date('Y') }}
                                        {% elseif kpiDetail.activeDate|date('m') == 06 %}
                                            Jun-{{ kpiDetail.activeDate|date('Y') }}
                                        {% elseif kpiDetail.activeDate|date('m') == 07 %}
                                            Jul-{{ kpiDetail.activeDate|date('Y') }}
                                        {% elseif kpiDetail.activeDate|date('m') == 08 %}
                                            Aug-{{ kpiDetail.activeDate|date('Y') }}
                                        {% elseif kpiDetail.activeDate|date('m') == 09 %}
                                            Sep-{{ kpiDetail.activeDate|date('Y') }}
                                        {% elseif kpiDetail.activeDate|date('m') == 10 %}
                                            Oct-{{ kpiDetail.activeDate|date('Y') }}
                                        {% elseif kpiDetail.activeDate|date('m') == 11 %}
                                            Nov-{{ kpiDetail.activeDate|date('Y') }}
                                        {% elseif kpiDetail.activeDate|date('m') == 12 %}
                                            Dec-{{ kpiDetail.activeDate|date('Y') }}
                                        {% endif %}
                                    </td>
                                    <td>
                                        {% if kpiDetail.endDate|date('m') == 01 %}
                                            Jan-{{ kpiDetail.endDate|date('Y') }}
                                        {% elseif kpiDetail.endDate|date('m') == 02 %}
                                            Feb-{{ kpiDetail.endDate|date('Y') }}
                                        {% elseif kpiDetail.endDate|date('m') == 03 %}
                                            Mar-{{ kpiDetail.endDate|date('Y') }}
                                        {% elseif kpiDetail.endDate|date('m') == 04 %}
                                            Apr-{{ kpiDetail.endDate|date('Y') }}
                                        {% elseif kpiDetail.endDate|date('m') == 05 %}
                                            May-{{ kpiDetail.endDate|date('Y') }}
                                        {% elseif kpiDetail.endDate|date('m') == 06 %}
                                            Jun-{{ kpiDetail.endDate|date('Y') }}
                                        {% elseif kpiDetail.endDate|date('m') == 07 %}
                                            Jul-{{ kpiDetail.endDate|date('Y') }}
                                        {% elseif kpiDetail.endDate|date('m') == 08 %}
                                            Aug-{{ kpiDetail.endDate|date('Y') }}
                                        {% elseif kpiDetail.endDate|date('m') == 09 %}
                                            Sep-{{ kpiDetail.endDate|date('Y') }}
                                        {% elseif kpiDetail.endDate|date('m') == 10 %}
                                            Oct-{{ kpiDetail.endDate|date('Y') }}
                                        {% elseif kpiDetail.endDate|date('m') == 11 %}
                                            Nov-{{ kpiDetail.endDate|date('Y') }}
                                        {% elseif kpiDetail.endDate|date('m') == 12 %}
                                            Dec-{{ kpiDetail.endDate|date('Y') }}
                                        {% endif %}
                                    </td>
                                    <td>{{ kpiDetail.cellName }}</td>
                                    <td>{{ kpiDetail.cellDetails }}</td>
                                </tr>
                            {% endfor %}
                            </tbody>
                        </table>
                    </div>

                </div>
            </div>
        </section>
    </div>
    <div class="create_kpi">
        <section>
            <div class="col-sm-11">
                <div class="add_new_users_views_screen">
                    <form class="form-horizontal no-style create-form" action="{{ path('kpidetails_new1') }}" method="post">
                        <div class="kpi_basic_details">
                            <fieldset class="fieldset_box add_rule_form">
                                <legend class="legend_name">Basic details</legend>
                                <div class="form-group">
                                    <label class="control-label col-xs-4"><strong>Select ship</strong></label>
                                    <div class="col-xs-8">
                                        {{ form_widget(form.shipDetailsId,{'id':'shipId','label': ''}) }}
                                        <div class="select_all">
                                            <label class="checkbox">
                                                <input type="checkbox" class="check" id="check">
                                            </label>
                                            <label class="checkbox_text">
                                                Select all
                                            </label>
                                        </div>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="control-label col-xs-4"><strong>KPI name</strong></label>
                                    <div class="col-xs-8">
                                        {{ form_widget(form.kpiName,{'id':'kpiid','label': ''})  }}
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="control-label col-xs-4"><strong>Weightage</strong></label>
                                    <div class="col-xs-8">
                                        {{ form_widget(form.weightage,{'id':'weightageId','label': ''}) }}
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="control-label col-xs-4"><strong>Description</strong></label>
                                    <div class="col-xs-8">
                                        {{ form_widget(form.description,{'id':'elementId','label': ''}) }}
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="control-label col-xs-4"><strong>Valid</strong></label>
                                    <div class="col-xs-8">
                                        <span>
                                            <select class="add_rule_basic_date_drop" name="activeMonth" class="full-width-select">
                                                <option selected="selected">--</option>
                                                <option value="1">Jan</option>
                                                <option value="2">Feb</option>
                                                <option value="3">Mar</option>
                                                <option value="4">Apr</option>
                                                <option value="5">May</option>
                                                <option value="6">Jun</option>
                                                <option value="7">Jul</option>
                                                <option value="8">Aug</option>
                                                <option value="9">Sep</option>
                                                <option value="10">Oct</option>
                                                <option value="11">Nov</option>
                                                <option value="12">Dec</option>
                                            </select>
                                        </span>
                                        <span>
                                            <select class="add_rule_basic_year_drop" name="activeyear" class="full-width-select">
                                                <option selected="selected">--</option>
                                                {% for i in 2000..2020 %}
                                                    <option value={{ i }}>{{ i }}</option>
                                                {% endfor %}
                                            </select>
                                        </span>
                                        <strong>To</strong>
                                        <span>
                                            <select class="add_rule_basic_date_drop" name="endMonth" class="full-width-select">
                                                <option selected="selected">--</option>
                                                <option value="1">Jan</option>
                                                <option value="2">Feb</option>
                                                <option value="3">Mar</option>
                                                <option value="4">Apr</option>
                                                <option value="5">May</option>
                                                <option value="6">Jun</option>
                                                <option value="7">Jul</option>
                                                <option value="8">Aug</option>
                                                <option value="9">Sep</option>
                                                <option value="10">Oct</option>
                                                <option value="11">Nov</option>
                                                <option value="12">Dec</option>
                                            </select>
                                        </span>
                                        <span>
                                            <select class="add_rule_basic_year_drop" name="endYear" class="full-width-select">
                                                <option selected="selected">--</option>
                                                {% for i in 2000..2020 %}
                                                    <option value={{ i }}>{{ i }}</option>
                                                {% endfor %}
                                            </select>
                                        </span>
                                    </div>
                                </div>
                            </fieldset>
                            <fieldset class="fieldset_box">
                                <legend class="legend_name">Excel details</legend>
                                <div class="form-group">
                                    <label class="control-label col-xs-4"><strong>Cell name</strong></label>
                                    <div class="col-xs-8">
                                        {{ form_widget(form.cellName,{'id':'valueid','label': ''}) }}
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="control-label col-xs-4"><strong>Cell detail</strong></label>
                                    <div class="col-xs-8">
                                        {{ form_widget(form.cellDetails,{'id':'valueid','label': ''}) }}
                                    </div>
                                </div>
                            </fieldset>
                        </div>
                        <div class="actions_submit">
                            <button class="submit_btn" id="submit_id" >Add</button>
                            <button type="reset" class="cancel_btn" >Reset</button>
                        </div>
                    </form>
                </div>
            </div>
        </section>
    </div>
    <div class = "show_kpi">
        <section>
            <div class="col-sm-11">
                <div class="view_new_user_screen_2 form_view_screen">
                    <div class="actions_edit_button">
                        <a href="" class="edit_btn edit_kpi_button">Edit</a>
                    </div>
                    <fieldset class="fieldset_box">
                        <legend class="legend_name">Basic details</legend>
                        <div class="form_view">
                            <label class="form_labell"><strong>Ship Name :</strong></label>
                            <label class="form_input ship_name"> </label>
                        </div>
                        <div class="form_view">
                            <label class="form_labell"><strong>KPI name :</strong></label>
                            <label class="form_input kpi_name"> </label>
                        </div>
                        <div class="form_view">
                            <label class="form_labell"><strong>Weightage :</strong></label>
                            <label class="form_input kpi_weightage"> </label>
                        </div>
                        <div class="form_view">
                            <label class="form_labell"><strong>Description :</strong></label>
                            <label class="form_input kpi_description"> </label>
                        </div>
                        <div class="form_view">
                            <label class="form_labell"><strong>Valid :</strong></label>
                            <label class="form_input">
                                <label><span class="kpi_activeDate_month "></span>-<sapn class=" kpi_activeDate_year"></sapn> <strong> To </strong> <span class=" kpi_endDate_month "></span>-<span class="  kpi_endDate_year"></span></label>
                            </label>
                        </div>
                    </fieldset>
                    <fieldset class="fieldset_box">
                        <legend class="legend_name">Excel details</legend>
                        <div class="form_view">
                            <label class="form_labell"><strong>Cell name :</strong></label>
                            <label class="form_input kpi_cellName"> </label>
                        </div>
                        <div class="form_view">
                            <label class="form_labell"><strong>Cell detail :</strong></label>
                            <label class="form_input kpi_cellDetail"> </label>
                        </div>
                    </fieldset>
                    {#<fieldset class="fieldset_box add_rule_right_edit_form show_rule_div">
                        <legend class="legend_name">Rules</legend>
                        <div class="table-responsive">
                            <table class="table view_rule_conditions">
                                <tr class="row_id">
                                    <th class="conditions" align="center">Conditions</th>
                                    <th class="color" align="center">Color</th>
                                </tr>
                            </table>
                            <table class="table view_rule_conditions rule_table" ></table>
                        </div>
                        <input type="hidden" id="kpi_id_reference_text" name="kpi_id_reference_text" value="">
                    </fieldset>#}
                </div>
            </div>
        </section>
    </div>
    <div class="grid_edit_kpi">
        <section>
            <div class="col-sm-11">
                <div class="add_new_users_views_screen">
                    <form class="form-horizontal no-style">
                        <div class="add_new_users_form">
                            <fieldset class="fieldset_box add_rule_form">
                                <legend class="legend_name">Basic details</legend>
                                <div class="form-group">
                                    <label class="control-label col-xs-4">Select ship</label>
                                    <div class="col-xs-8 ">
                                        <select multiple class="ship_name_edit" id="editShipId"></select>
                                        <div class="select_all">
                                            <label class="checkbox">
                                                <input type="checkbox" class="check" id="edit-check">
                                            </label>
                                            <label class="checkbox_text">
                                                Select all
                                            </label>
                                        </div>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="control-label col-xs-4">KPI name</label>
                                    <div class="col-xs-8">
                                        <input type="text" class="edit_kpi_name" value="" placeholder="">
                                        <input type="hidden" class="kpi_edit_id" value="" placeholder="">
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="control-label col-xs-4">Weightage</label>
                                    <div class="col-xs-8">
                                        <input type="text" class="edit_kpi_weightage" value="" placeholder="">
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="control-label col-xs-4">Description</label>
                                    <div class="col-xs-8">
                                        <input type="text" class="edit_kpi_description" value="" placeholder="">
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="control-label col-xs-4">Valid</label>
                                    <div class="col-xs-8">
                                <span>
                                    <select class="month_text add_rule_basic_date_drop active_month ">
                                        <option value="0">JAN</option>
                                        <option value="1">FEB</option>
                                        <option value="2">MAR</option>
                                        <option value="3">APR</option>
                                        <option value="4">MAY</option>
                                        <option value="5">JUN</option>
                                        <option value="6">JUL</option>
                                        <option value="7">AUG</option>
                                        <option value="8">SEP</option>
                                        <option value="9">OCT</option>
                                        <option value="10">NOV</option>
                                        <option value="11">DEC</option>
                                    </select>
                                </span>
                                <span>
                                    <select class="year_text add_rule_basic_year_drop active_year">
                                        {% for i in 2000..2020 %}
                                            <option value={{ i }}>{{ i }}</option>
                                        {% endfor %}
                                    </select>
                                </span>
                                        <strong>To</strong>
                                <span>
                                    <select class="month_text add_rule_basic_date_drop end_month">
                                        <option value="0">JAN</option>
                                        <option value="1">FEB</option>
                                        <option value="2">MAR</option>
                                        <option value="3">APR</option>
                                        <option value="4">MAY</option>
                                        <option value="5">JUN</option>
                                        <option value="6">JUL</option>
                                        <option value="7">AUG</option>
                                        <option value="8">SEP</option>
                                        <option value="9">OCT</option>
                                        <option value="10">NOV</option>
                                        <option value="11">DEC</option>
                                    </select>
                                </span>
                                 <span>
                                    <select class="year_text add_rule_basic_year_drop end_year">
                                        {% for i in 2000..2020 %}
                                            <option value={{ i }}>{{ i }}</option>
                                        {% endfor %}
                                    </select>
                                </span>
                                    </div>
                                </div>
                            </fieldset>
                            <fieldset class="fieldset_box">
                                <legend class="legend_name">Excel details</legend>
                                <div class="form-group">
                                    <label class="control-label col-xs-4">Cell name</label>
                                    <div class="col-xs-8">
                                        <input type="text" class="edit_kpi_cellName" value="" placeholder="">
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="control-label col-xs-4">Cell detail</label>
                                    <div class="col-xs-8">
                                        <input type="text" class="edit_kpi_cellDetails" value="" placeholder="">
                                    </div>
                                </div>
                            </fieldset>
                            {#<fieldset class="fieldset_box add_rule_right_edit_form edit_rule_div">
                                <legend class="legend_name">Rules</legend>
                                <div class="table-responsive">
                                    <table class="table edit_rule_conditions">
                                        <tr class="row_edit_id">
                                            <th class="conditions">Conditions</th>
                                            <th class="color">Color</th>
                                            <th class="edit">Edit</th>
                                            <th class="action">Delete</th>
                                        </tr>
                                    </table>
                                    <table class="table edit_rule_conditions rule_table_edit"></table>
                                </div>
                            </fieldset>
                        </div>
                        <div id="rule_obj_text"></div>
                        <div class="kpi_rules">
                            <fieldset class="fieldset_box add_rule_right_edit_form rule_edit_place">
                                <legend class="legend_name">Rules Create</legend>
                                <div class="form-group button">
                                    <div class="col-xs-9">
                                        <div id="conditions-edit"></div>
                                    </div>
                                </div>
                                <div class="form-group button">
                                    <div class="col-xs-9">
                                        <div id="actions-edit"></div>
                                    </div>
                                </div>
                                <div class="form-group button">
                                    <div class="col-xs-9 ">
                                        <div id="rule_edit_button"></div>
                                    </div>
                                </div>
                            </fieldset>#}
                        </div>
                        <div class="actions_submit">
                            <button class="submit_btn edit_submit_button" type="submit" value="Submit">Save</button>
                            <button class="cancel_btn edit_cancel_button" value="Submit">Cancel</button>
                        </div>
                    </form>
                </div>
            </div>
        </section>
    </div>
{% endblock %}