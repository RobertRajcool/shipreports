
{% extends 'base.html.twig' %}
{% block body %}

    {% block javascripts %}

        {#{% javascripts '@InitialShippingBundle/Resources/public/js/aa_jquery-1.8.0.min.js' %}
        <script src="{{ asset_url }}"></script>
        {% endjavascripts %}#}
        {#{% javascripts '@InitialShippingBundle/Resources/public/js/emailgroup.js' %}
        <script src="{{ asset_url }}"></script>
        {% endjavascripts %}#}

        <script>
            $(document).ready(function()
            {


                /* $("#datepikerid").datepicker({
                 dateFormat: "MM-yy"
                 }).datepicker("setDate", new Date());
                 alert($('#datepikerid').val())*/

                $('#nogroupselected').hide();
                $('#kpiformforship').show();
                var shipid='{{ currentshipid }}';
                var shipname='{{ currentshipname }}';
                $('#'+shipid).addClass('active');
                $('#shipid').val(shipid);
                $('#shipname').text(shipname);

                var nowdate=new Date(),
                        locale = "en-us",
                        month = nowdate.toLocaleString(locale, { month: "long" }),
                        year=nowdate.getFullYear();
                $('#currentid').text(month+'-'+year)
                $('#datofmonthid').val(month+'-'+year)
                $('#proviousmonth').click(function($e)
                {
                    $e.preventDefault();
                    var currentdate=new Date($('#currentid').text());
                    currentdate.setMonth(currentdate.getMonth() - 1);
                    currentdate,locale = "en-us",
                            month = currentdate.toLocaleString(locale, { month: "long" }),
                            year=currentdate.getFullYear();
                    $('#currentid').text(month+'-'+year)
                    $('#datofmonthid').val(month+'-'+year)
                });
                $('#nextmonth').click(function($e)
                {
                    $e.preventDefault();
                    var currentdate=new Date($('#currentid').text());
                    currentdate.setMonth(currentdate.getMonth() + 1);
                    currentdate,locale = "en-us",
                            month = currentdate.toLocaleString(locale, { month: "long" }),
                            year=currentdate.getFullYear();
                    $('#currentid').text(month+'-'+year)
                    $('#datofmonthid').val(month+'-'+year)
                });
                $('.linkclass').on('click',function()
                {

                    var linkid = $(this).attr('id');
                    var shipname = $(this).attr('title');
                    $('#shipid').val('');

                    $('#addkpiformid').html('');
                    $('#addkpiformid').text('');
                    $('#shipname').text(' ');
                    var dataofmonth=$('#currentid').text();
                    $.ajaxSetup({
                        global: false,
                        type: "post",
                        'url': Routing.generate('shipskpielment_forranking', {'shipid':linkid,'monthdetail':dataofmonth}),
                        beforeSend: function () {
                            var text='Please Wait';

                            if($('body').find('#resultLoading').attr('id') != 'resultLoading'){
                                $('body').append('<div id="resultLoading" style="display:none"><div><img src="/images/ajax-loader.gif"><div>'+text+'</div></div><div class="bg"></div></div>');
                            }

                            $('#resultLoading').css({
                                'width':'100%',
                                'height':'100%',
                                'position':'fixed',
                                'z-index':'10000000',
                                'top':'0',
                                'left':'0',
                                'right':'0',
                                'bottom':'0',
                                'margin':'auto'
                            });

                            $('#resultLoading .bg').css({
                                'background':'#000000',
                                'opacity':'0.7',
                                'width':'100%',
                                'height':'100%',
                                'position':'absolute',
                                'top':'0'
                            });

                            $('#resultLoading>div:first').css({
                                'width': '250px',
                                'height':'75px',
                                'text-align': 'center',
                                'position': 'fixed',
                                'top':'0',
                                'left':'0',
                                'right':'0',
                                'bottom':'0',
                                'margin':'auto',
                                'font-size':'16px',
                                'z-index':'10',
                                'color':'#ffffff'

                            });

                            $('#resultLoading .bg').height('100%');
                            $('#resultLoading').fadeIn(300);
                            $('body').css('cursor', 'wait');
                        },
                        complete: function () {
                            $('#resultLoading .bg').height('100%');
                            $('#resultLoading').fadeOut(300);
                            $('body').css('cursor', 'default');
                        }
                    });
                    $.ajax({

                        success: function(data)
                        {

                            var valuearray=data.elementvalues;
                            $('#shipid').val(linkid);
                            $('#shipname').text(shipname);
                            $('#nogroupselected').hide();
                            $('#kpiformforship').show();
                            $('.linkclass').removeClass("active");
                            $('#'+linkid).addClass('active');
                            var j=1;
                            var newtemp=0;
                            $.each(data.kpiNameArray, function(i, listkpi)
                                    {

                                        var k=$.isNumeric(i);
                                        if(!k)
                                        {
                                            var temp=1

                                            $('<table class="table kpi_table_form_section"><thead><tr><th colspan="'+data.elementcount+'">'+i+'</th></tr></thead> <tbody id="tablebody'+j+'">').appendTo('#addkpiformid');
                                            $.each(listkpi,function(mykey,myvalue)
                                            {
                                                if(valuearray.length>0)
                                                {

                                                    $('#updatebuttonid').show();
                                                    $('#savebuttonid').show();
                                                    $('#adminbuttonid').show();


                                                    if(temp==1)
                                                    {
                                                        $('<tr><td  class="kpi_lement_name">'+myvalue+'</td> <td class="kpi_lement_inputname"><input placeholder="123" onkeypress="return isNumberKey(event)"  value="'+data.elementvalues[newtemp]+'" type="text" name="newelemetvalues[]" required ></td></tr>').appendTo("#tablebody"+j);
                                                    }
                                                    if(temp>1)
                                                    {
                                                        $('<tr ><td class="kpi_lement_name">'+myvalue+'</td> <td class="kpi_lement_inputname"><input placeholder="123" type="text" name="newelemetvalues[]" onkeypress="return isNumberKey(event)" value="'+data.elementvalues[newtemp]+'" required ></td></tr>').appendTo("#tablebody"+j);
                                                    }


                                                }
                                                else
                                                {
                                                    $('#updatebuttonid').show();
                                                    $('#savebuttonid').show();
                                                    $('#adminbuttonid').show();

                                                    if(temp==1)
                                                    {
                                                        $('<tr><td  class="kpi_lement_name">'+myvalue+'</td> <td class="kpi_lement_inputname"><input placeholder="123" type="text" name="newelemetvalues[]" required onkeypress="return isNumberKey(event)" ></td></tr>').appendTo("#tablebody"+j);
                                                    }
                                                    if(temp>1)
                                                    {
                                                        $('<tr><td class="kpi_lement_name">'+myvalue+'</td> <td class="kpi_lement_inputname"><input type="text" placeholder="123"  onkeypress="return isNumberKey(event)" name="newelemetvalues[]" required ></td></tr>').appendTo("#tablebody"+j);
                                                    }


                                                }
                                                temp++;
                                                newtemp++;


                                            });
                                            $(' </tr></tbody></table>').appendTo('#addkpiformid');


                                        }
                                        j++;
                                    });

                                    },
                        error: function(XMLHttpRequest, textStatus, errorThrown)
                        {
                            alert('Error : ' + errorThrown);
                        }
                    });

                });

                /*$('.textbox').live('keypress',function (event) {
                 alert('functioncall');
                 return isNumber(event, this)
                 });*/
                $(".textbox").on("keypress keyup blur",function (event) {
                    //this.value = this.value.replace(/[^0-9\.]/g,'');
                    $(this).val($(this).val().replace(/[^0-9\.]/g,''));
                    if ((event.which != 46 || $(this).val().indexOf('.') != -1) && (event.which < 48 || event.which > 57)) {
                        event.preventDefault();
                    }
                });

                function isNumber(evt, element) {

                    var charCode = (evt.which) ? evt.which : event.keyCode

                    if (
                            (charCode != 45 || $(element).val().indexOf('-') != -1) &&      // “-” CHECK MINUS, AND ONLY ONE.
                            (charCode != 46 || $(element).val().indexOf('.') != -1) &&      // “.” CHECK DOT, AND ONLY ONE.
                            (charCode < 48 || charCode > 57))
                        return false;

                    return true;
                }
                $('#resetbuttonid').click(function($e)
                {
                    $e.preventDefault();
                    $('.textbox').val(' ');
                });

                $("#kpiform").submit(function($e)
                        {
                            var preshipid=$('#shipid').val();
                            var btn= $(this).find("input[type=submit]:focus").attr('id');
                            $e.preventDefault();
                            var formid = $('#kpiform');
                            $.ajaxSetup({
                                global: false,
                                type: "post",
                                'url': Routing.generate('addkpivaluesname_forranking', {'buttonid':btn}),
                                data: formid.serialize(),
                                beforeSend: function () {
                                    var text='Please Wait';

                                    if($('body').find('#resultLoading').attr('id') != 'resultLoading'){
                                        $('body').append('<div id="resultLoading" style="display:none"><div><img src="/images/ajax-loader.gif"><div>'+text+'</div></div><div class="bg"></div></div>');
                                    }

                                    $('#resultLoading').css({
                                        'width':'100%',
                                        'height':'100%',
                                        'position':'fixed',
                                        'z-index':'10000000',
                                        'top':'0',
                                        'left':'0',
                                        'right':'0',
                                        'bottom':'0',
                                        'margin':'auto'
                                    });

                                    $('#resultLoading .bg').css({
                                        'background':'#000000',
                                        'opacity':'0.7',
                                        'width':'100%',
                                        'height':'100%',
                                        'position':'absolute',
                                        'top':'0'
                                    });

                                    $('#resultLoading>div:first').css({
                                        'width': '250px',
                                        'height':'75px',
                                        'text-align': 'center',
                                        'position': 'fixed',
                                        'top':'0',
                                        'left':'0',
                                        'right':'0',
                                        'bottom':'0',
                                        'margin':'auto',
                                        'font-size':'16px',
                                        'z-index':'10',
                                        'color':'#ffffff'

                                    });

                                    $('#resultLoading .bg').height('100%');
                                    $('#resultLoading').fadeIn(300);
                                    $('body').css('cursor', 'wait');
                                },
                                complete: function () {
                                    $('#resultLoading .bg').height('100%');
                                    $('#resultLoading').fadeOut(300);
                                    $('body').css('cursor', 'default');
                                }
                            });

                            $.ajax({
                                success: function(data)
                                {
                                    var valuearray=data.elementvalues;
                                    $('#preshipid').append('<img src="/images/tick_icon.png">');
                                    var valuearray=data.elementvalues;
                                    $('#shipid').val('');
                                    $('#addkpiformid').html('');
                                    $('#addkpiformid').text('');
                                    $('#shipname').text(' ');
                                    $('#verfiybuttonid').show();


                                    if(data.shipid!=0)
                                    {

                                        $('#shipid').val(data.shipid);
                                        $('#shipname').text(data.shipname);
                                        $('#nogroupselected').hide();
                                        $('#kpiformforship').show();
                                        $('.linkclass').removeClass("active");
                                        $('#'+data.shipid).addClass('active');


                                        var j=1;
                                        var newtemp=0;
                                        $.each(data.kpiNameArray, function(i, listkpi)
                                        {

                                            var k=$.isNumeric(i);
                                            if(!k)
                                            {
                                                var temp=1

                                                $('<table  class="table kpi_table_form_section"><thead><tr><th colspan="'+data.elementcount+'">'+i+'</th></tr></thead> <tbody id="tablebody'+j+'">').appendTo('#addkpiformid');
                                                $.each(listkpi,function(mykey,myvalue)
                                                {
                                                    if(valuearray.length>0)
                                                    {

                                                        $('#updatebuttonid').show();
                                                        $('#savebuttonid').show();
                                                        $('#adminbuttonid').show();
                                                        if (temp == 1) {
                                                            $('<tr><td  class="kpi_lement_name">' + myvalue + '</td> <td class="kpi_lement_inputname"><input value="'+data.elementvalues[newtemp]+'" placeholder="123" type="text" name="newelemetvalues[]" required></td></tr>').appendTo("#tablebody" + j);
                                                        }
                                                        if (temp > 1) {
                                                            $('<tr><td class="kpi_lement_name">' + myvalue + '</td> <td class="kpi_lement_inputname"><input type="text" placeholder="123" value="'+data.elementvalues[newtemp]+'" name="newelemetvalues[]" required ></td></tr>').appendTo("#tablebody" + j);
                                                        }
                                                    }
                                                    else
                                                    {
                                                        $('#updatebuttonid').show();
                                                        $('#savebuttonid').show();
                                                        $('#adminbuttonid').show();
                                                        if (temp == 1) {
                                                            $('<tr><td  class="kpi_lement_name">' + myvalue + '</td> <td class="kpi_lement_inputname"><input placeholder="123" type="text" name="newelemetvalues[]" required ></td></tr>').appendTo("#tablebody" + j);
                                                        }
                                                        if (temp > 1) {
                                                            $('<tr><td class="kpi_lement_name">' + myvalue + '</td> <td class="kpi_lement_inputname"><input type="text" placeholder="123" name="newelemetvalues[]" required ></td></tr>').appendTo("#tablebody" + j);
                                                        }
                                                    }
                                                    newtemp++;
                                                    temp++;

                                                });
                                                $(' </tbody></table>').appendTo('#addkpiformid');


                                            }
                                            j++;


                                        });
                                        alert(data.returnmsg);
                                    }
                                    else
                                    {
                                        $('#shipid').val(' ');
                                        $('#shipname').text(' ');
                                        $('#nogroupselected').show();
                                        $('#kpiformforship').hide();
                                        alert(data.returnmsg);
                                    }
                                },
                                error: function(XMLHttpRequest, textStatus, errorThrown)
                                {
                                    alert('Error : ' + errorThrown);
                                }
                            });




                        }
                );

                /* $('#datpickerid').datepicker();*/
                /* $(document.body).delegate('.textbox', 'keypress', function(e)
                 {
                 alert('fucntion call')
                 return isNumber(e, this)
                 });*/

                // $( "#datepikerid" ).datepicker();


            });


            function isNumberKey(e)
            {
                /* var charCode = (evt.which) ? evt.which : event.keyCode
                 if (charCode != 46 && charCode > 31
                 && (charCode < 48 || charCode > 57))
                 return false;

                 return true;*/
                if (e.which != 46 && e.which != 45 && e.which != 46 &&
                        !(e.which >= 48 && e.which <= 57)) {
                    return false;
                }
            }

        </script>

    {% endblock %}


    <section>
        <div class="col-sm-3 views_kpi_form_list">
            <div class="views_kpi_name_total"><span>{{ 'dashboard.shipname'|trans }}  ({{ shipcount }})</span></div>
            <div class="views_kpi_form_list_main">
                <ui>

                    {% set j=0 %}
                    {% for shipobject in listofships %}
                        <li>
                            <a class="linkclass" title="{{ shipobject.shipName }}" id="{{ shipobject.id }}" >{{ shipobject.shipName }}</a>

                            {%  if  is_granted("ROLE_KPI_INFO_PROVIDER") %}


                                {% if status_ship[j]==1 %}
                                    <img src="/images/tick_icon.png">
                                {% endif %}
                            {% endif %}
                            {%  if  is_granted("ROLE_ADMIN") %}

                                {% if status_ship[j]==3 %}
                                    <img src="/images/tick_icon.png">
                                {% endif %}
                            {% endif %}

                            {%  if is_granted("ROLE_MANAGER") %}
                                {% if status_ship[j]==2 %}
                                    <img src="/images/tick_icon.png">
                                {% endif %}

                            {% endif %}

                        </li>
                        {% set j=j+1 %}

                    {% endfor %}


                </ui>
            </div>

        </div>
    </section>
    <section id="nogroupselected">
        <div class="col-sm-8 col-md-offset-6 no_user_selected_views">
            <div class="text_image">
                <img src="/images/no-user.png">
                <label>{{ 'dataverification.noship'|trans }} </label>
            </div>
        </div>
    </section>
    <section id="kpiformforship">
        <div class="col-sm-12">
            <div  class="add_new_kpi_form_screen">
                <form id="kpiform" class="form-horizontal no-style">
                    <div class="add_new_kpi_top_title">
                        <div class="title_month">
                            <label class="title"> <span id="shipname"> </span></label>
                            <label class="toolbar-title">

                                <a id="proviousmonth" class="left-arrow ss-navigateleft">&nbsp;</a>
                                <span id="currentid" class="item">March-2016</span>
                                <input type="hidden" name="dataofmonth" id="datofmonthid">
                                <a id="nextmonth" class="right-arrow ss-navigateright">&nbsp;</a>
                            </label>
                        </div>
                    </div>

                    <div class="add_new_kpi_form_section">
                        {% if elementkpiarray|length <= 0 %}
                            No Kpi Found
                        {% endif %}
                        {% if elementkpiarray|length > 0 %}
                            <div id="addkpiformid" class="table-responsive">

                                {% set i=0 %}
                                {% for key, value in elementkpiarray %}
                                    <table class="table kpi_table_form_section">
                                        <thead>
                                        <tr>
                                            <th colspan=" {{ elementcount }} ">  {{ key }}</th>
                                        </tr>
                                        </thead>
                                        <tbody>

                                        {% for user in value %}

                                            <tr>
                                                <td class="kpi_lement_name">{{ user }}  </td>
                                                <td class="kpi_lement_inputname">
                                                    {% if elementvalues|length <= 0 %}

                                                        <input onkeypress="return isNumberKey(event)" name="newelemetvalues[]" type="text"  required placeholder="123">
                                                    {% endif %}
                                                    {% if elementvalues|length > 0 %}
                                                        <input onkeypress="return isNumberKey(event)" name="newelemetvalues[]" type="text" value="{{ elementvalues[i] }}" required placeholder="123">
                                                    {% endif %}
                                                </td>
                                            </tr>

                                            {% set i=i+1 %}

                                        {% endfor %}
                                        </tbody>
                                    </table>
                                {% endfor %}
                            </div>
                        {% endif %}


                    </div>
                    <input type="hidden" name="shipid" id="shipid">
                    <div class="actions_submit">

                        {%  if  is_granted("ROLE_KPI_INFO_PROVIDER") %}

                            <input type="submit" class="submit_btn" id="savebuttonid"  value="{{ 'dataverification.save'|trans }}">
                            <button class="cancel_btn" id="resetbuttonid"  value="Submit">{{ 'dataverification.reset'|trans }}</button>
                        {% endif %}
                        {%  if  is_granted("ROLE_ADMIN") %}

                            <input type="submit" class="submit_btn" id="adminbuttonid"  value="{{ 'dataverification.upload'|trans }}">
                        {% endif %}

                        {%  if is_granted("ROLE_MANAGER") %}
                            <input type="submit" class="submit_btn" id="verfiybuttonid"  value="{{ 'dataverification.verfiy'|trans }}">

                        {% endif %}
                    </div>
                </form>
            </div>
        </div>
    </section>

{% endblock %}